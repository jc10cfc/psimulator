\chapter{Analıza a~návrh øešení}\label{kap:analyza}
% Analıza a~návrh implementace (vèetnì diskuse rùznıch alternativ a~volby implementaèního prostøedí).

% Architektura
%   pocatecni navrh
%   novy navrh: klient - server
%   telnet
%   diskuze nad nacitanim a ukladanim
%   Smerovani + RT (stary navrh - 1 spolecna, novy navrh - wrapper) + prijem paketu
%   NAT 
% Podobnost simulátoru
% Pøedpokládanı rozsah
% Programovací jazyk
% Pamìová nároènost
% Uivatelské rozhraní

%------------------------------------------------------------------------------

\section{Architektura}

\subsection{Naivní návrh}
Po zadání projektu jsem vytvoøil poèáteèní návrh aplikace a po konzultaci s~kolegou (kadı si udìlal svùj návrh) vznikl tzv. naivní návrh (viz obrázek \ref{fig:navrh}). Tato prvotní varianta poèítala s~pøipojením do skuteèné sítì, ale byla zavrena zejména kvùli sloitosti takového systému a èasové nároènosti implementace. Navíc propojení s reálnou sí není mezi poadavky.

\begin{figure}[h]
\begin{center}
\includegraphics[width=12cm]{figures/navrh}
\caption{Poèáteèní návrh}
\label{fig:navrh}
\end{center}
\end{figure}

%------------------------------------------------------------------------------

\subsection{Klient - server}\label{klient_server}
Dle nového návrhu bude celá aplikace rozdìlena na dvì základní vrstvy:
\begin{itemize}
 \item komunikaèní - bude zajišovat spojení mezi klientskou a serverovou èástí aplikace
 \item aplikaèní - bude tvoøit zbytek systému (smìrování, pøeklad adres, parsery pøíkazù, ..)
\end{itemize}

\subsubsection{Komunikaèní vrstva}
Komunikaèní vrstva bude sloena z~architektury klient - server. Tato vrstva bude pøevzata ze semestrální práce pro pøedmìt \verb|Y36PSI|, kde bylo za úkol mimo jiné implementovat více-vláknovı server. V~této pøevzaté implementaci je server, ke kterému se pøipojují klienti. Pro kadého klienta se vytvoøí nové vlákno, take není problém obsluhovat více klientù zároveò. 

Cílem aplikace je vytvoøit simulátor poèítaèové sítì, ta bude muset bıt reprezentována objekty, které budou zastupovat jednotlivé poèítaèe. Kadı poèítaè se bude muset chovat jako server, aby se na nìj mohlo pøipojit více klientù najednou. Tak bude splnìn jeden z~funkèních poadavkù.

Pro pøipojení klientù bude pouit program \verb|telnet|. Více o~návrhu v~kapitole \ref{telnet}. 


\subsubsection{Aplikaèní vrstva}
Tuto vrstvu bude tvoøit pøedevším parser pøíkazù emulující Cisco IOS, smìrování paketù, routovací tabulku a pøeklad adres. Aplikaèní vrstva bude kvùli vìtší pøehlednosti více rozebrána v~kapitole Realizace \ref{realizace}.

%------------------------------------------------------------------------------

\subsection{Telnet} \label{telnet}
V~zadání je pøímo zmínìno pouití programu telnet pro pøipojení klientù k~serveru. Telnet je ale také protokol, po kterém se domlouvá telnet klient a telnet server. Èeská wikipedie píše o~telnet protokolu: \uv{\textit{Protokol pøenáší osmibitové znaky obìma smìry (duplexní spojení) a je velmi jednoduchı.}}\cite{wiki:telnet} Protokol tedy vše posílá po znaku a protistrana po znaku vše potvrzuje. Telnet protokol zaène pøi navazování spojení vyjednávácí proces, kterı vyjedná s protistranou budoucí nastavení.

Samotnı telnet (a protokol èi program) ale neposkytuje doplòování pøíkazù nebo alespoò historii pøíkazù. Dalším problémem je, e pøi psaní pøíkazù pøes telnet nefunguje editace aktuálního øádku, respektive lze mazat po znacích klávesou \verb|BackSpace|, ale nelze se pohybovat do stran šipkami doleva a doprava - pøi takovém pokusu to vypíše \verb|^[[D| èi \verb|^[[C|. 

Øešením by mohlo bıt zkusit posílat nìjaké speciální znaky pro posun kurzoru do stran, aby server vìdìl, e má nastat posun vlevo èi vpravo. Pak by si musel server pamatovat, na které pozici øádku je klient. Nepøišel jsem však na zpùsob, jak pøesvìdèit program telnet pro posílání nìjakého znaku na událost \uv{šipka doprava}, take tento návrh jsem musel zavrhnout.

Posun kurzoru se ale neprojevuje pøi pøipojování na vlastní telnet server. To je zpùsobeno tím, e v~takovém pøípadì se o~editaci øádku a historii pøíkazù stará samotnı server - v~mém pøípadì telnet server a BASH\footnote{Bourne again shell - nejpouívanìjší unixovı shell}. V~této aplikaci toho ale nelze vyuít, take musí bıt tyto funkcionality na stranì klienta, kterı je bude zajišovat. 

Pro linux jsem našel program rlwrap (readline wrapper), kterı pøidává všechny tyto uiteèné funkce: editace øádky, historie pøíkazù, doplòování pøíkazù, obarvení promptu. Pro Windows jsem nic takového nenašel, take uivatelé OS Windows budou muset tuto aplikaci spouštìt pøes program Cygwin. Vıhodou tohoto øešení je lepší uivatelskı komfort linuxové pøíkazové øádky ne nativní Windows konzole \verb|cmd|.

%------------------------------------------------------------------------------

\subsection{Konfiguraèní soubor}
Pøi startu serveru by se mìla naèíst konfigurace ze souboru a mìla by bıt monost uloit aktuální konfiguraci zpìt do stejného souboru. Diskuze nad monımi øešeními je popsána v~kapitole \ref{xml_soubor}.

%------------------------------------------------------------------------------

\subsection{Smìrovaè}
Na skuteèné poèítaèové síti jsou síové prvky nìkolika druhù (router, switch, bridge, repeater, ..), ale na laboratorních cvièeních pøedmìtu Y36PSI se  nastavují pouze smìrovaèe ze 3. vrstvy\footnote{Tato \uv{síová vrstva} se stará o~smìrování v~síti a síové adresování. Dále poskytuje spojení mezi vzdálenımi sítìmi, které spolu pøímo nesousedí.} síového ISO/OSI modelu. Proto tato práce bude implementovat pouze jeden typ síového prvku - smìrovaè (router). 

%------------------------------------------------------------------------------

\section{Podobnost simulátoru se skuteènım smìrovaèem}\label{kap:podobnost}
Jedním z~cílù projektu je vytvoøit systém, kterı bude co nejvíce podobnı skuteènému smìrovaèi cisco. Bude ale potøeba poloit nìkde hranici mezi sloitostí a vìrností vısledné práce, protoe tyto dvì metriky jsou vzájemném protikladu. Cisco IOS je natolik robustní a propracovanı systém, e je v~mıch silách implementace pouze úzké èásti systému, která je nutnì potøeba pro splnìní cíle. Pravdìpodobnì budu nucen místy ustoupit a nechat vypsat hlášení, e to èi ono není v~mé implementaci podporováno. 

V~samotném parseru pøíkazù pro Cisco IOS nebude takovéto hlášení témìø vùbec øešeno, protoe by to znamenalo implementaci nìkolika stovek pravidel pro všechny pøíkazy - napø. pøíkaz \verb|ip| má 103 moností v~konfiguraèním stavu. Aby ale uivatel mìl alespoò nìjakou monost se dopátrat, co je èi není podporováno, tak bude pøidán pøíkaz \verb|help| (\verb|help_en| pro vıpis v~angliètinì), kterı bude popisovat, jakı pøíkaz lze v~kterém stavu Cisca pouít.

%------------------------------------------------------------------------------

\section{Pøedpokládanı rozsah}
Celı projekt by mìl bıt v~rozsahu zhruba 10000 øádkù kódu. Nejrozsáhlejší tøídy budou pravdìpodobnì datové struktury pro všechny objekty, které budou emulovat skuteèné poèítaèe s~rozhraními, routovací a NAT tabulku atd.

%------------------------------------------------------------------------------

\section{Programovací jazyk a prostøedí}
Pro implementaci simulátoru jsem si zvolil programovací jazyk Java hned z~nìkolika dùvodù. Jazyk je to velmi robustní s~bohatou sadou rùznıch knihoven. Navíc programy vytvoøené v~tomto jazyce jsou zpravidla jednoduše pøenositelné mezi rùznımi operaèními systémy, co je jeden z~bodù nefunkèních poadavkù. Jazyk Java disponuje propracovanım systémem vıjimek, take pøi nìjaké neoèekávané chybì se dozvím víc, ne v~jazyce C++ s~jeho \verb|Segmentation fault|. Neménì vıznamnım dùvodem je i skuteènost, e s~Javou mám zatím nejvìtší zkušenosti.

Celá práce bude implementována v~Netbeans IDE\footnote{Integrated Development Environment} verze 6.8.

%------------------------------------------------------------------------------

\section{Pamìová nároènost}
Pamìová nároènost bude pravdìpodobnì vyšší ne pøi pouití jazyka C++, jeliko javovskı garbage collector není úplnì ideálním øešením pro uvolòování pamìti. Nicménì se neoèekává pouití tohoto simulátoru pro více ne pár desítek virtuálních poèítaèù, take spotøeba pamìti by nemìla pøekroèit poadavky pro bìné aplikace v~Javì. Zaplnìní pamìti touto aplikací by mohlo bıt kolem odhadem 10-30MB (+ naètené prostøedí JRE).

%------------------------------------------------------------------------------

\section{Uivatelské rozhraní}
Uivatelské rozhraní by mìlo bıt v~zásadì velmi jednoduché. Vše bude ovládáno pøes pøíkazovou øádku, tak jako na skuteèném ciscu. Spuštìní serveru bude ulehèeno pomocnım skriptem \verb|start_server.sh|, kterı bude zároveò obsahovat nápovìdu. Pro pøipojování klientù budou rovnì pøipraveny skripty. 

Na obrázku \ref{fig:uziv_rozh} je pøíklad, jak by mohlo uivatelské rozhraní vypadat pod operaèním systémem Linux.

\begin{figure}[h]
\begin{center}
\includegraphics[height=3cm]{figures/uziv_rozhrani}
\caption{Textové rozhraní pro konfiguraci cisca}
\label{fig:uziv_rozh}
\end{center}
\end{figure}









