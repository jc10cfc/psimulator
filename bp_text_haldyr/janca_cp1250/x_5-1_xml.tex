\section{Naèítání ze souboru} \label{xml_soubor}
\subsection{Zpracování parametrù}
Po spuštìní startovacího skriptu \verb|start_server.sh| se nejdøíve zpracují všechny parametry. Kdy je nalezen parametr \verb|-n|, tak se naèítá z~konfiguraèního souboru pouze kostra sítì s~poèítaèema a rozhraníma bez jejich nastavení. Pozice tohoto parametru není dùleitá, systém nejprve detekuje pøítomnost tohoto parametru a pak u ho ignoruje. Další parametr je název konfiguraèního souboru, ten mùe bıt zadán bez koncovky \verb|.xml|, nejdøíve se zkusí naèíst soubor bez koncovky a kdy takovı soubor není, tak se naète soubor s~koncovkou. Tøetím parametrem je port, od kterého budou poslouchat jednotlivé poèítaèe. Port je nepovinnı, ve vıchozím stavu je to port 4000. Kdy je danı port obsazenı, tak se program ukonèí z~chybovou hláškou.

%------------------------------------------------------------------------------

\subsection{Konfiguraèní soubor}
Nejdøíve bylo nutno rozhodnout podobu vısledného konfiguraèního souboru. Existuje nìkolik moností, napø.:
\begin{itemize}
 \item javovské \verb|Properties| ve stylu \uv{promìnná = hodnota}, moc se nehodí na velmi èlenité struktury
\begin{verbatim}
compile.on.save=false
do.depend=false
do.jar=true
javac.debug=true
\end{verbatim} 

 \item podoba konfiguraèních souborù KDE\footnote{K Desktop Environment je desktopové prostøedí pro Linux a další unixové operaèní systémy.}, kde jednotlivé sekce jsou oddìleny jménem v~hranatıch závorkách
\begin{verbatim}
[Xdmcp]
Enable=false
[Shutdown]
# Default is "/sbin/halt"
HaltCmd=/sbin/shutdown
\end{verbatim} 

 \item XML\footnote{Extensible Markup Language je rozšiøitelnı znaèkovací jazyk} soubor, kterı umoòuje libovolnou strukturu
\end{itemize}

Já jsem si vybral technologii XML pro jeho robustnost a velmi dobrou èitelnost.

Naèítání z~XML souboru lze udìlat minimálnì dvìma zpùsoby: Vzít cizí knihovnu, která tuto funkcionalitu zajišuje, nebo vytvoøit vlastní tøídu. Obì monosti mají své vıhody i nevıhody. Cizí knihovna by mohla bıt témìø bez práce a pravdìpodobnì by podporovala i zpìtné ukládání. Na druhou stranu by byla malá monost ovlivnìní vısledného vıstupu a bylo by vše na té knihovnì závislé. Navíc s~novımi verzemi by se mohla mìnit i její funkènost. Znamenalo by to také instalaci této knihovny na uivatelskıch poèítaèích. Z~tìchto dùvodù jsem zvolil druhou variantu: vlastní implementace zpracování XML. 

%------------------------------------------------------------------------------

\subsection{Implementace SAX handleru}
Zpracovat XML lze pøes technologii DOM\footnote{Document Object Model} a SAX\footnote{Simple API for XML}. Já se rozhodl pro SAX z~tìchto dùvodù:
\begin{itemize}
 \item jednorázové sekvenèní ètení
 \item menší pamìová nároènost
 \item oproti DOMu i nìkolikrát rychlejší, co by mohlo bıt znatelné u~velmi rozlehlé síì
\end{itemize}

Mùj \verb|SAXHandler| tvoøí tøi èásti: samotné naèítání, datová struktura pro poèítaè a vytváøení virtuálního poèítaèe.

\subsubsection{Naèítání}
\verb|ContentHandler| \uv{vyhazuje} události pøi zpracování XML souboru. \verb|SAXHandler| musí tyto události odchytávat a pokud je to událost, která nás zajímá, tak se zpracuje tj. uloí do datové sktruktury. \verb|SAXHandler| musí implementovat metody na zpracování zaèátku elementu, konce elementu, znaková data a konce dokumentu. Po naètení konce elementu se vytvoøí virtuální sí poèítaèù. Pro správnou funkci \verb|SAXHandler| je dùleité mít ve sloce s~konfiguraèními soubory také soubor DTD\footnote{Document Type Definition}, kterı definuje strukturu XML dokumentu.

\subsubsection{Datová struktura}
Pro ukládání informací slouí datová struktura \verb|PocitacBuilder|, která si drí veškeré informace naètené z~XML souboru o~jednom poèítaèi:
\begin{itemize}
 \item jméno a typ poèítaèe
 \item nastavení rozhraní - jméno, adresa, maska, stav
 \item routovací tabulka - vıèet záznamù
 \item ip\_forward - pro potøeby OS linux
 \item pøeklad adres - pooly adres, access-listy, pøiøazení access-listù k~poolùm, statické záznamy
\end{itemize}

Pak je tu ještì sekundární struktura pro uloení kabelù k~jednotlivım poèítaèùm.

\subsubsection{Vytváøení virtuálních poèítaèù}
Po vyhození události konec souboru se zaènou vyrábìt virtuální poèítaèe. Pokud byl pouit parametr \verb|-n|, tak se nejdøíve smaou nastavení, která nemají bıt naètena. Po té se postupnì budou naèítat (a kontrolovat) všechna uloená nastavení. V~zásadì lze øíci, e kdy systém narazí na neplatná data v~konfiguraèním souboru, tak vypíše chybovou hlášku na standardní chybovı vıstup. Pokud je to chyba zásadní, tak se vyhodí vıjimka, vypíše hláška a celı server se ukonèí, protoe nemùe pokraèovat v~další èinnosti. Slovem zásadní je myšleno napø. chybìjící jméno rozhraní (kabely v~XML jsou napojeny pøes jména rozhraní), nataené kabely a opakující se jména poèítaèù èi rozhraní na jednom poèítaèi. Kabely jsou natolik klíèovou vìcí, e uivatele upozorní na chybu pádem programu s~vıpisem, co je špatnì. 

Takto vypadá pøíklad konfiguraèního souboru:
\begin{verbatim}
<pocitac jmeno="cisco1" typ="cisco">
  <rozhrani>
    <jmeno>FastEthernet0/0</jmeno>
    <ip>192.168.1.254</ip>
    <maska>255.255.255.0</maska>
    <mac>00:0b:0c:0d:0a:01</mac>
    <nahozene>true</nahozene>
    <nat>soukrome</nat>
  </rozhrani>
\end{verbatim} 

Nastavení propojení mezi poèítaèi (respektive jejich rozhraními) je dáno v~konfiguraèním souboru. Pùvodnì kadé rozhraní obsahovalo informaci, ke kterému rozhraní kterého poèítaèe je pøipojeno. To se ale ukázalo jako zbyteènì matoucí, protoe informace o~kabelu tam byla obsaena dvakrát. V~dnešní verzi programu je to zjednodušené tak, e samotné rozhraní nenese ádnou informaci o~kabelu. Kabely jsou v~konfiguraèním souboru zvláš. Tento pøíklad ukazuje propojení tøech poèítaèù:

\begin{verbatim}
<kabelaz>
  <kabel>
    <prvni>linux1:eth0</prvni>
    <druhy>linux2:eth0</druhy>
  </kabel>
  <kabel>
    <prvni>linux2:eth1</prvni>
    <druhy>cisco1:FastEthernet0/0</druhy>
  </kabel>
  <kabel>
    <prvni>cisco1:FastEthernet0/1</prvni>
    <druhy>cisco2:FastEthernet0/0</druhy>
  </kabel>
</kabelaz>
\end{verbatim} 

Konce kabelu jsou charakterizovány dvìma záznamy, kadı obsahuje jméno poèítaèe a rozhraní oddìlené dvojteèkou.

%------------------------------------------------------------------------------

\section{Ukládání do souboru}
Abstraktní \verb|ParserPrikazu| obsahuje metodu, do které jsou vloeny spoleèné pøíkazy pro všechny operaèní systémy. V~souèasné dobì je tam pouze pøíkaz \verb|uloz| alias \verb|save|. Uivatel mùe pouít jakoukoliv variantu dle libosti. Pøi zavolání tohoto pøíkazu bez parametru se bude ukládat do stejného souboru, ze kterého se pøi staru aplikace naèítalo. Nebo mùe uivatel specifikovat jméno souboru (vèetnì cesty), do kterého se má aktuální konfigurace uloit. 

Ukládání do souboru je realizováno èistì textovì, tzn. vše se posílá pøes \verb|BufferedWriter| bez pouítí externích knihoven. Pro usnadnìní práce jsem si napsal nìkolik pomocnıch metod, kde napø. pro uloení MAC adresy do XML staèí zavolat \\\verb|zapisElement("mac", rozhrani.macAdresa)|. Velmi uiteèná metoda je také \verb|vratElement|, která postaví element s~danım jménem a obsahem:
\begin{verbatim}
private String vratElement(String jmeno, String obsah) {
  if (obsah == null) {
    obsah = "";
  }
  return "<" + jmeno + ">" + obsah + "</" + jmeno + ">\n";
}
\end{verbatim} 


Vıhodou tohoto øešení je maximální kontrola nad vıstupem pøíkazu \verb|save| a jednudochost této implementace. Mezi nevıhody bych uvedl hlavnì zmìnu v~datovıch strukturách. Kdy by bylo potøeba pøipsat novou volbu, která by se mìla ukládat do XML souboru, tak je nutné pøidat pravidla pro naèítání z~XML v~\verb|SAXHandler| a navíc zde pro ukládání.





